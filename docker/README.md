# Ditto + TICK stack

Includes docker-compose.yaml for a TICK + Ditto stack containing:

- Influx
- Grafana
- Telegraf
- Chronograf
- Ditto

...This will connect to any number of datasources you like.

Dashboard need to be autogenerated!

The TICK stack is, at present, all run inside one Docker container. It works fine but could be split as in the sandbox here:

https://github.com/influxdata/sandbox

## Scripts

`start.sh` pulls Ditto version 0.9.0 and spins up the docker-compose stack

`get_repos.sh` script will pull the repos that inspired TICK stuff. They might be handy for reference or future inspiration.

## Sample docker run command with UDMIduino Telegraf config

```sh
docker run --rm --ulimit nofile=66000:66000 \
  -d \
  --name docker-statsd-influxdb-grafana \
  -p 3003:3003 \
  -p 3004:8888 \
  -p 8086:8086 \
  -p 8125:8125/udp \
  samuelebistoletti/docker-statsd-influxdb-grafana:latest
```

## Helpful commands

Restart Telegraf, say after a config tweak (when `exec .. bash`'d in)
```
/etc/init.d/telegraf restart
```

View telegraf logs (also when `exec .. bash`'d in)

```
tail -f /var/log/telegraf/telegraf.log
```

Subscribe to mosquitto topics with a cafile:

```
mosquitto_sub -h localhost -d -p 8883 -v -t '#' --cafile /etc/mosquitto/certs/mosq-ca.crt
```

Mosquitto certs generated as:

https://dzone.com/articles/mqtt-security-securing-a-mosquitto-server

Good cert commands:

https://gist.github.com/webtobesocial/5313b0d7abc25e06c2d78f8b767d4bc3

Bonus!

Verify an x509 cert:

```
openssl x509 -in mosq-serv.crt -noout -text
```

## Links that helped
https://github.com/influxdata/telegraf/issues/4580
https://gist.github.com/soheilhy/8b94347ff8336d971ad0